import{d as X,g as w,i as _,s as Z,o as l,e as n,a as d,u as c,Z as G,w as g,b as e,t as r,p as u,c as M,F as k,y as P,h as m,v as C,C as H,l as U,O as f}from"./app-Bq8-TzmE.js";import{_ as B,a as D}from"./TextInput-BRM3l3nA.js";import{S as J}from"./SectionContainer-49OzEMUN.js";import{b as K,a as y,_ as Y}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-DWuAYgVp.js";import{T as ee,a as te}from"./ToastSuccess-CB9z8LLo.js";import{_ as se}from"./SearchInput.vue_vue_type_script_setup_true_lang-B9v7qFUF.js";import{j as F}from"./maska-Cp-LWreF.js";import{P as ae}from"./Pagination-C9hcPNHN.js";import{_ as oe}from"./PrintReceiptModal.vue_vue_type_script_setup_true_lang-CZp0uynF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"flex gap-6 items-center justify-center"},re=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Registar Venda ",-1),ne=e("span",{class:"text-gray-800"},"|",-1),ie={class:"flex items-center flex-col md:flex-row md:gap-2"},de={class:"text-lg font-bold text-gray-800"},ce={class:"font-semibold text-xs pt-0.5"},ue={class:"grid"},me=e("h1",{class:"text-xl font-semibold mb-6"},"Venda",-1),pe={class:"overflow-x-auto"},fe={class:"overflow-x-auto flex justify-between md:grid md:grid-cols-1 min-w-full gap-12 md:gap-2"},he=e("li",null,[e("div",{class:"grid md:grid-cols-5 gap-1"},[e("span",{class:"font-semibold"},"Produto"),e("span",{class:"font-semibold"},"PreÃ§o"),e("span",{class:"font-semibold"},"Quantidade"),e("span",{class:"font-semibold"},"Total"),e("span",{class:"md:text-end font-semibold"},"Remover")])],-1),ve={class:"grid md:grid-cols-5 text-end md:text-start min-w-full gap-1"},_e={class:"block w-full whitespace-nowrap"},ge={class:"ml-10"},ye={class:"flex items-center justify-end w-full h-full"},be=["onClick"],xe=e("hr",{class:"my-6"},null,-1),we={key:1,class:"flex justify-center gap-3 items-center flex-col md:flex-row"},ke=e("option",{disabled:"",selected:""},"Pagamento",-1),Ce=["value"],Te={class:"md:self-end"},qe={class:"font-semibold text-lg text-gray-800"},Ve={class:"font-semibold text-lg text-gray-800"},Se={class:"mt-6 bg-white p-6 rounded-md"},Me=e("h1",{class:"text-3xl font-bold mb-2 text-gray-800 text-center"}," Produtos ",-1),Pe={class:"grid lg:grid-cols-4 mx-auto gap-3 text-gray-800 w-full"},$e={class:"grid p-2 gap-3 w-full"},je={class:"h-32 relative"},Re={class:"absolute bg-black opacity-80 rounded-lg w-full"},Ue=["src","alt"],Be={class:"flex justify-between items-center w-full"},De={class:"text-wrap truncate ... font-semibold text-lg"},Fe={class:"card-actions justify-end flex-col"},Ie=["onClick"],Ge=X({__name:"Create",props:{cashier:{},products:{},paymentMethods:{},search:{}},setup(I){const p=I,h=w(p.search),A=_(()=>p.products.links.map(s=>{if(s.url===null)return s;let o=new URL(s.url);return h.value&&o.searchParams.set("product",h.value),{...s,url:`${o}`}})),b=w(!1),T=w(!1),q=w(!1),t=Z({products:[],delivery:"",discount:"",paymentMethod:null,total:0}),$=_(()=>t.products.reduce((s,o)=>s+o.price*o.quantity,0)),j=_(()=>t.delivery?parseFloat(t.delivery.replace(",",".")):0),R=_(()=>t.discount?parseFloat(t.discount.replace(",",".")):0),V=_(()=>{const s=t.paymentMethod===1?5:0,i=t.products.reduce((x,a)=>x+a.price*a.quantity,0)+j.value-R.value;return i+i*(s/100)}),E=s=>{if(!p.cashier||p.cashier.active===!1){alert("Caixa fechado, abra o caixa para realizar vendas.");return}const o=t.products.findIndex(i=>i.id===s.id);o===-1?t.products.push({id:s.id,name:s.name,price:s.price,quantity:1}):t.products[o].quantity++,t.total=V.value},N=s=>{const o=t.products.findIndex(i=>i.id===s.id);o!==-1&&(t.products[o].quantity>1?t.products[o].quantity--:t.products.splice(o,1))},z=()=>{if(t.products.length===0){alert("Adicione produtos para realizar a venda.");return}const s={products:t.products.map(o=>({id:o.id,quantity:o.quantity,price:o.quantity*o.price})),cashier_id:p.cashier.id,delivery_tax:j.value,discount:R.value,payment_type_id:t.paymentMethod,subtotal:$.value,total:V.value};t.products=[],t.delivery="",t.discount="",t.paymentMethod=null,t.total=0,receipt.showModal(),f.post(route("sells.store"),s),f.on("success",()=>{T.value=!0,receipt.showModal(),setTimeout(()=>{T.value=!1},4e3)}),f.on("error",()=>{q.value=!0,setTimeout(()=>{q.value=!1},4e3)})},L=()=>{f.post(route("cashiers.store"))},W=s=>{confirm("Deseja realmente fechar o caixa?")&&f.put(route("cashiers.update",p.cashier.id))},O=s=>{h.value=s,f.get(route("sells.create",{product:h.value}),{},{preserveState:!0,preserveScroll:!0})};return(s,o)=>(l(),n(k,null,[d(c(G),{title:"Venda"}),d(Y,null,{header:g(()=>[e("div",le,[re,ne,e("div",ie,[e("h3",de," Caixa: "+r(s.$page.props.auth.user.name),1),e("small",ce," ("+r(c(K)(s.$page.props.auth.user.role))+") ",1)])])]),default:g(()=>{var i,S,x;return[!s.cashier||!((i=s.cashier)!=null&&i.active)?(l(),n("button",{key:0,class:"btn btn-primary btn-lg w-full",onClick:L}," Abrir Caixa ")):u("",!0),s.cashier&&((S=s.cashier)!=null&&S.active)?(l(),M(J,{key:1,class:"min-h-[20vh] flex flex-col"},{default:g(()=>[e("div",ue,[me,e("div",pe,[e("ul",fe,[he,(l(!0),n(k,null,P(t.products,(a,v)=>(l(),n("li",{key:v},[e("div",ve,[e("p",_e,r(a.name),1),e("span",null,r(c(y)(a.price)),1),e("span",ge,r(a.quantity),1),e("span",null,r(c(y)(a.price*a.quantity)),1),e("div",ye,[e("button",{onClick:Q=>N(a),class:"font-semibold bg-error rounded-full h-6 w-6 my-0.5 text-white cursor-pointer hover:bg-red-600 text-center"}," X ",8,be)])])]))),128))])]),xe,t.total>0?(l(),n("button",{key:0,class:"link mt-6 w-full self-center",onClick:o[0]||(o[0]=a=>b.value=!b.value)},r(b.value?"Remover desconto.":"Adicionar desconto?"),1)):u("",!0),t.total>0?(l(),n("div",we,[e("div",null,[d(B,{for:"delivery",value:"Taxa de entrega"}),m(d(D,{id:"delivery",type:"text",class:"block w-full",modelValue:t.delivery,"onUpdate:modelValue":o[1]||(o[1]=a=>t.delivery=a),autofocus:"",autocomplete:"delivery","data-maska":"0.99","data-maska-tokens":"0:\\d:multiple|9:\\d:optional",placeholder:"R$ 00.00"},null,8,["modelValue"]),[[c(F)]])]),m(e("div",null,[d(B,{for:"discount",value:"Desconto"}),m(d(D,{id:"discount",type:"text",class:"block w-full",modelValue:t.discount,"onUpdate:modelValue":o[2]||(o[2]=a=>t.discount=a),autofocus:"",autocomplete:"discount","data-maska":"0.99","data-maska-tokens":"0:\\d:multiple|9:\\d:optional",placeholder:"R$ 00.00"},null,8,["modelValue"]),[[c(F)]])],512),[[C,b.value]]),m(e("select",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm md:self-end","onUpdate:modelValue":o[3]||(o[3]=a=>t.paymentMethod=a)},[ke,(l(!0),n(k,null,P(s.paymentMethods,(a,v)=>(l(),n("option",{key:v,value:a.id},r(a.name),9,Ce))),128))],512),[[H,t.paymentMethod]]),e("div",Te,[e("h2",qe," Subtotal: "+r(c(y)($.value)),1),e("h2",Ve," Total: "+r(c(y)(V.value)),1)])])):u("",!0),e("button",{onClick:z,class:"btn btn-primary mt-6 w-full text-xl"}," Criar venda ")])]),_:1})):u("",!0),s.cashier&&((x=s.cashier)!=null&&x.active)?(l(),n("button",{key:2,class:"btn btn-error btn-lg w-full mt-6",onClick:W}," Fechar Caixa ")):u("",!0),e("div",Se,[Me,d(se,{class:"my-4",placeholder:"Pesquisar produtos",onSearch:O,q:h.value},null,8,["q"]),e("div",Pe,[(l(!0),n(k,null,P(s.products.data,(a,v)=>(l(),n("div",{key:v,class:"card card-side border border-slate-50 items-center shadow-sm"},[e("div",$e,[m(e("figure",je,[m(e("span",{class:"text-2xl text-white font-bold absolute top-12 text-center z-10"},r(a.name),513),[[C,!a.imageUrl]]),m(e("div",Re,null,512),[[C,!a.imageUrl]]),e("img",{src:a.imageUrl?"/storage/"+a.imageUrl:"/storage/logos/pdvfacil.png",alt:a.name,class:"object-cover w-full h-full rounded-lg"},null,8,Ue)],512),[[C,a]]),e("div",Be,[e("div",null,[e("h2",De,r(a.name),1),e("p",null,r(c(y)(a.price)),1)]),e("div",Fe,[e("button",{onClick:Q=>E(a),class:"btn btn-info btn-sm w-full"}," Adicionar ",8,Ie)])])])]))),128))]),d(ae,{class:"mt-6",links:A.value},null,8,["links"])]),T.value?(l(),M(ee,{key:3},{default:g(()=>[U(" Venda criada com sucesso! ")]),_:1})):u("",!0),q.value?(l(),M(te,{key:4},{default:g(()=>[U(" Erro ao criar venda! ")]),_:1})):u("",!0),d(oe)]}),_:1})],64))}});export{Ge as default};
