import{o as c,e as u,b as t,F as P,y as S,t as d,u as r,d as F,g as E,s as L,i as O,c as j,w as f,a as i,Z as I,l as y,k as K,x as v,m as x,p,O as g}from"./app-Bq8-TzmE.js";import{a as _,_ as z,c as Q,f as R}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-DWuAYgVp.js";import{S as Y}from"./SectionContainer-49OzEMUN.js";import{P as Z}from"./Pagination-C9hcPNHN.js";import{_ as b}from"./DateInput.vue_vue_type_script_setup_true_lang-C3SDWOtl.js";import{_ as U}from"./SearchInput.vue_vue_type_script_setup_true_lang-B9v7qFUF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={id:"productModal",class:"modal w-full"},X={class:"modal-box bg-white"},A=t("form",{method:"dialog"},[t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"}," ✕ ")],-1),G={class:"w-full"},H={class:"table"},J=t("thead",{class:"text-black font-bold text-lg"},[t("tr",null,[t("th",null,"Produto"),t("th",null,"Valor"),t("th",null,"Quantidade"),t("th",null,"Total")])],-1),tt={class:"w-36 truncate ..."},et={__name:"SellProductsModal",props:{products:Object},setup(o){return(n,l)=>(c(),u("div",null,[t("dialog",W,[t("div",X,[A,t("div",G,[t("table",H,[J,t("tbody",null,[(c(!0),u(P,null,S(o.products,e=>(c(),u("tr",{key:e.id},[t("td",null,[t("p",tt,d(e.name),1)]),t("td",null,d(r(_)(e.price)),1),t("td",null,d(e.pivot.quantity),1),t("td",null,d(r(_)(e.pivot.price)),1)]))),128))])])])])])]))}};var w=/^([0-9]{4})-([0-1][0-9])(?:-([0-3][0-9]))?(?:[T ]?([0-2][0-9])(?::([0-5][0-9]))?(?::([0-5][0-9]))?)?(?:\.[0-9]+)?(Z|(?:\+|\-)[0-9]{2}:?[0-9]{2})?$/;function st(o){const n=o.match(w);if(n){const l=Number(n[2]);if(l<1||l>12)return!1;if(typeof n[3]!==void 0){const e=Number(n[3]);if(e<1||e>31)return!1}if(typeof n[4]!==void 0){const e=Number(n[4]);if(e<0||e>23)return!1}return!0}return!1}function ot(o){const n=o.match(w);return n&&typeof n[4]>"u"?o+="T00:00:00":o}function k(o){if(o||(o=new Date),o instanceof Date){const n=new Date(o);return n.setMilliseconds(0),n}if(o=o.trim(),st(o))return new Date(ot(o));throw new Error(`Non ISO 8601 compliant date (${o}).`)}function nt(o,n){const l=k(o),e=k(n);return l.getDate()===e.getDate()&&l.getMonth()===e.getMonth()&&l.getFullYear()===e.getFullYear()}const at=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Vendas ",-1),lt={class:"grid gap-2 justify-center items-center"},rt=t("h2",{class:"text-3xl font-bold text-center"},"Pesquisas",-1),ct={class:"flex gap-6 flex-col lg:items-center lg:justify-center lg:flex-row"},dt={class:"grid gap-2 my-2"},it=t("h3",{class:"text-lx font-semibold"}," Pesquisa por Produto ",-1),ut={class:"flex items-center gap-4"},_t={class:"grid gap-2 my-2"},ht=t("h3",{class:"text-lx font-semibold"},"Pesquisa por Data",-1),mt={class:"flex items-center gap-4"},ft={class:"grid gap-2 my-2"},pt=t("h3",{class:"text-lx font-semibold"}," Pesquisa por Período ",-1),gt={class:"flex lg:items-center flex-col lg:flex-row gap-4"},bt={class:"grid lg:grid-cols-3 gap-6"},yt={key:0,class:"text-center"},vt=t("h1",{class:"text-2xl font-bold py-16"}," Nenhuma venda encontrado. ",-1),xt=[vt],kt={key:1,class:"min-h-[20vh] flex flex-col mt-6"},Pt={class:"overflow-x-auto"},St={class:"table"},wt={class:"text-black font-bold text-lg"},Dt=t("th",null,"Data",-1),$t=t("th",null,"Entrega",-1),Ct=t("th",null,"Forma de Pagamento",-1),qt=t("th",null,"Desconto",-1),Mt=t("th",null,"Subtotal",-1),Bt=t("th",null,"Total",-1),Nt=t("th",null,"Produtos",-1),Vt={key:0},Tt={class:"text-gray-700 font-bold text-md"},Ft=["onClick"],Et={key:0},Lt=["onClick"],Yt=F({__name:"Index",props:{sells:{},user:{},search:{}},setup(o){const n=E([]),l=o,e=L({page:1,start_date:l.search.start_date??"",end_date:l.search.end_date??"",product:l.search.product??"",date:l.search.date??""}),D=O(()=>l.sells.links.map(s=>{if(s.url===null)return s;let m=new URL(s.url);for(const a in e)a!=="page"&&e[a]!==""&&m.searchParams.set(a,e[a]);return{...s,url:`${m}`}})),$=s=>{document.getElementById("productModal").showModal(),n.value=l.sells.data.find(m=>m.id===s).products},C=s=>{confirm("Tem certeza que quer cancelar essa venda?")&&g.delete(route("sells.destroy",s))},h=()=>{Q(e),g.get(route("sells.index",{...e}),{},{preserveState:!0,preserveScroll:!0})},q=()=>{e.start_date="",e.end_date="",e.product="",e.date="",g.get(route("sells.index"),{},{preserveScroll:!0})},M=s=>{e.date=s,h()},B=s=>{e.product=s,h()},N=s=>{e.start_date=s},V=s=>{e.end_date=s};return(s,m)=>(c(),j(z,null,{header:f(()=>[at]),default:f(()=>[i(r(I),{title:"Vendas"}),i(r(K),{href:s.route("sells.create"),class:"btn btn-primary mb-6"},{default:f(()=>[y("Criar Nova Venda")]),_:1},8,["href"]),i(Y,null,{default:f(()=>[t("div",lt,[rt,t("div",ct,[t("div",dt,[it,t("div",ut,[i(U,{onSearch:B,q:e.product},null,8,["q"])])]),t("div",_t,[ht,t("div",mt,[i(b,{onSearchDate:M,d:e.date},null,8,["d"])])]),t("div",ft,[pt,t("div",gt,[i(b,{onSearchDate:N,d:e.start_date,onKeyup:v(h,["enter"])},null,8,["d"]),y(" até "),i(b,{onSearchDate:V,d:e.end_date,onKeyup:v(h,["enter"])},null,8,["d"])])])]),t("div",bt,[t("button",{type:"button",class:"btn btn-primary lg:col-span-2",onClick:x(h,["prevent"])}," Pesquisar "),t("button",{type:"button",class:"btn btn-secondary",onClick:x(q,["prevent"])}," Limpar ")])]),s.sells.data.length?p("",!0):(c(),u("div",yt,xt)),s.sells.data.length?(c(),u("div",kt,[t("div",Pt,[t("table",St,[t("thead",wt,[t("tr",null,[Dt,$t,Ct,qt,Mt,Bt,Nt,s.user.role!=="cashier"?(c(),u("th",Vt,"Cancelar")):p("",!0)])]),t("tbody",Tt,[(c(!0),u(P,null,S(s.sells.data,a=>(c(),u("tr",{key:a.id},[t("td",null,d(r(R)(a.created_at)),1),t("td",null,d(r(_)(a.delivery_tax)),1),t("td",null,d(a.payment_type.name),1),t("td",null,d(a.discount?r(_)(a.discount):"-"),1),t("td",null,d(r(_)(a.subtotal)),1),t("td",null,d(r(_)(a.total)),1),t("td",null,[t("button",{class:"btn btn-primary",onClick:T=>$(a.id)}," Ver Produtos ",8,Ft)]),s.user.role!=="cashier"&&r(nt)(a.cashier.created_at,new Date)?(c(),u("td",Et,[t("button",{class:"btn btn-error btn-sm rounded-full",onClick:T=>C(a.id)}," X ",8,Lt)])):p("",!0)]))),128))])])])])):p("",!0),i(et,{products:n.value},null,8,["products"]),i(Z,{class:"mt-6",links:D.value},null,8,["links"])]),_:1})]),_:1}))}});export{Yt as default};
